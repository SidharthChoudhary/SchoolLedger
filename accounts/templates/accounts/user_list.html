{% extends "website/base.html" %}
{% block title %}User Management{% endblock %}
{% block content %}

<h2 style="margin-top:0;">User Management</h2>

<!-- Search Bar -->
<div class="card" style="margin-bottom:20px;">
  <form method="get" style="display: flex; gap: 10px; align-items: flex-end;">
    <div style="flex: 1; min-width: 250px;">
      <label style="font-weight: 700;">Search Users</label>
      <input type="text" name="search" value="{{ search_query }}" placeholder="Username, email, or name..." style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; height: 40px;">
    </div>
    <button type="submit" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; height: 40px;">Search</button>
    {% if search_query %}
      <a href="{% url 'user_list' %}" style="padding: 8px 16px; background: #6b7280; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; height: 40px; display: inline-flex; align-items: center;">Clear</a>
    {% endif %}
  </form>
</div>

<!-- Users Table -->
<div class="card">
  <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f3f4f6; border-bottom: 2px solid #d1d5db;">
          <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Username</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Full Name</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Email</th>
          <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Roles</th>
          <th style="padding: 12px; text-align: center; border: 1px solid #e5e7eb; font-weight: 700;">Status</th>
          <th style="padding: 12px; text-align: center; border: 1px solid #e5e7eb; font-weight: 700;">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr style="border-bottom: 1px solid #e5e7eb;">
            <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: 500;">
              {{ user.username }}
              {% if user.is_superuser %}
                <span style="display: inline-block; background: #dc2626; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 8px;">SUPERUSER</span>
              {% endif %}
            </td>
            <td style="padding: 12px; border: 1px solid #e5e7eb;">{{ user.profile.full_name }}</td>
            <td style="padding: 12px; border: 1px solid #e5e7eb;">{{ user.email|default:"â€”" }}</td>
            <td style="padding: 12px; border: 1px solid #e5e7eb;">
              {% for role_name in user.profile.get_role_display_names %}
                <span style="display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-right: 4px; margin-bottom: 4px; font-weight: 600;">
                  {{ role_name }}
                </span>
              {% empty %}
                <span style="color: #9ca3af;">No roles</span>
              {% endfor %}
            </td>
            <td style="padding: 12px; border: 1px solid #e5e7eb; text-align: center;">
              {% if user.is_active %}
                <span style="display: inline-block; background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">Active</span>
              {% else %}
                <span style="display: inline-block; background: #fee2e2; color: #991b1b; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">Inactive</span>
              {% endif %}
            </td>
            <td style="padding: 12px; border: 1px solid #e5e7eb; text-align: center;">
              <a href="{% url 'user_detail' user.id %}" style="padding: 6px 12px; background: #3b82f6; color: white; text-decoration: none; border-radius: 4px; font-size: 12px; font-weight: 600;">Manage</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" style="padding: 20px; text-align: center; color: #6b7280;">No users found</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
