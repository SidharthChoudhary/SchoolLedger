{% extends "website/base.html" %}
{% block title %}{{ role.display_name }} - Role Details{% endblock %}
{% block content %}

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <h2 style="margin:0;">{{ role.display_name }}</h2>
  <a href="{% url 'role_list' %}" style="padding: 10px 20px; background: #6b7280; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">← Back to Roles</a>
</div>

<!-- Role Info -->
<div class="card" style="margin-bottom: 20px;">
  <h3 style="margin-top: 0; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">Role Information</h3>
  
  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 15px 0;">
    <div>
      <label style="font-weight: 700; color: #6b7280; font-size: 12px;">Role Name (Code)</label>
      <p style="margin: 5px 0 0 0; font-size: 16px; font-family: monospace;">{{ role.name }}</p>
    </div>
    <div>
      <label style="font-weight: 700; color: #6b7280; font-size: 12px;">Status</label>
      <p style="margin: 5px 0 0 0; font-size: 16px;">
        <span style="display: inline-block; {% if role.is_active %}background: #dcfce7; color: #166534;{% else %}background: #fee2e2; color: #991b1b;{% endif %} padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">
          {% if role.is_active %}Active{% else %}Inactive{% endif %}
        </span>
      </p>
    </div>
    <div style="grid-column: 1 / -1;">
      <label style="font-weight: 700; color: #6b7280; font-size: 12px;">Description</label>
      <p style="margin: 5px 0 0 0; font-size: 14px;">{{ role.description|default:"—" }}</p>
    </div>
  </div>
</div>

<!-- Permissions -->
<div class="card" style="margin-bottom: 20px;">
  <h3 style="margin-top: 0; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">Permissions ({{ role.permissions.count }})</h3>
  
  <div style="padding: 15px 0;">
    {% if role.permissions.all %}
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px;">
        {% for perm in role.permissions.all %}
          <div style="background: #f0f9ff; border: 1px solid #bfdbfe; padding: 12px; border-radius: 6px;">
            <p style="margin: 0 0 4px 0; font-weight: 600; color: #1e40af;">{{ perm.codename }}</p>
            <p style="margin: 0; font-size: 12px; color: #6b7280;">{{ perm.name }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #9ca3af;">No permissions assigned to this role</p>
    {% endif %}
  </div>
</div>

<!-- Assigned Users -->
<div class="card">
  <h3 style="margin-top: 0; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">Assigned to Users ({{ assigned_users.count }})</h3>
  
  <div style="overflow-x: auto;">
    {% if assigned_users %}
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: #f3f4f6; border-bottom: 2px solid #d1d5db;">
            <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Username</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Full Name</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Email</th>
            <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb; font-weight: 700;">Assigned At</th>
            <th style="padding: 12px; text-align: center; border: 1px solid #e5e7eb; font-weight: 700;">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for user_role in assigned_users %}
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: 500;">{{ user_role.user.username }}</td>
              <td style="padding: 12px; border: 1px solid #e5e7eb;">{{ user_role.user.profile.full_name }}</td>
              <td style="padding: 12px; border: 1px solid #e5e7eb;">{{ user_role.user.email|default:"—" }}</td>
              <td style="padding: 12px; border: 1px solid #e5e7eb; font-size: 12px; color: #6b7280;">{{ user_role.assigned_at|date:"M d, Y H:i" }}</td>
              <td style="padding: 12px; border: 1px solid #e5e7eb; text-align: center;">
                <a href="{% url 'user_detail' user_role.user.id %}" style="padding: 6px 12px; background: #3b82f6; color: white; text-decoration: none; border-radius: 4px; font-size: 12px; font-weight: 600;">Manage User</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="color: #9ca3af; padding: 15px 0; margin: 0;">No users have this role assigned</p>
    {% endif %}
  </div>
</div>

{% endblock %}
