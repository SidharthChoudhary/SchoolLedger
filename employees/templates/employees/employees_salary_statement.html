{% extends "website/base.html" %}
{% block title %}Employees Salary Statement{% endblock %}
{% block content %}

<h2 style="margin-top:0;">Employees Salary Statement</h2>

<!-- Selection Panel -->
<div class="card" style="margin-bottom:14px;">
  <h3 class="form-section">Select Session</h3>
  
  <form method="get" style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap;">
    <div style="flex: 1; min-width: 250px;">
      <label style="font-weight: 700;">Session</label>
      <select name="session" style="height:40px; width:100%;">
        <option value="">-- Select Session --</option>
        {% for session in sessions %}
          <option value="{{ session.id }}" {% if session.id|stringformat:"s" == selected_session_id %}selected{% endif %}>
            {{ session.session }}
          </option>
        {% endfor %}
      </select>
    </div>
    
    <div style="flex: 1; min-width: 250px;">
      <label style="font-weight: 700;">Status</label>
      <select name="status" style="height:40px; width:100%;">
        <option value="">-- All Status --</option>
        {% for value, label in status_choices %}
          <option value="{{ value }}" {% if value == selected_status %}selected{% endif %}>
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>
    
    <button type="submit" style="height:40px; padding: 0 20px;">Generate Statement</button>
  </form>
</div>

<!-- Statement Display -->
{% if selected_session %}
<div class="card" style="margin-bottom:14px;">
  <h3 class="form-section">Employees Salary Summary - {{ selected_session.session }}</h3>
  <div style="overflow-x:auto; margin-bottom:30px;">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#f3f4f6; border-bottom:2px solid #d1d5db;">
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Employee</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Post</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Status</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#fef08a;">Old Due Amount</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#dbeafe;">Salary Amount</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#e0f2fe;">Paid Amount</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#dcfce7;">Net Due Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for row in employee_rows %}
          <tr style="border-bottom:1px solid #e5e7eb;">
            <td style="padding:10px; border:1px solid #e5e7eb; font-weight:500;">{{ row.employee_name }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ row.employee_post }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;"><span style="padding:4px 8px; border-radius:4px; font-size:12px; font-weight:600; {% if row.employee_status == 'Active' %}background:#d1fae5; color:#065f46;{% else %}background:#fee2e2; color:#991b1b;{% endif %}">{{ row.employee_status }}</span></td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#fef08a;">₹ {{ row.old_dues|floatformat:0 }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dbeafe;">₹ {{ row.salary_data|floatformat:0 }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe;">₹ {{ row.paid_amount|floatformat:0 }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dcfce7; font-weight:500; {% if row.due < 0 %}color:#dc2626;{% elif row.due > 0 %}color:#15803d;{% else %}color:#6b7280;{% endif %}">
              {% if row.due < 0 %}-₹ {{ row.due|floatformat:0|cut:'-' }}{% elif row.due > 0 %}₹ {{ row.due|floatformat:0 }}{% else %}₹ 0{% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" style="padding:20px; text-align:center; color:#6b7280;">No employees found for this session</td>
          </tr>
        {% endfor %}
        {% if employee_rows %}
        <tr style="background:#f3f4f6; border-top:2px solid #d1d5db; border-bottom:2px solid #d1d5db; font-weight:700;">
          <td colspan="3" style="padding:10px; border:1px solid #e5e7eb; text-align:right;">Total</td>
          <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#fef08a;">₹ {{ totals.old_dues|floatformat:0 }}</td>
          <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dbeafe;">₹ {{ totals.salary_data|floatformat:0 }}</td>
          <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe;">₹ {{ totals.paid_amount|floatformat:0 }}</td>
          <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dcfce7; font-weight:700; {% if totals.due < 0 %}color:#dc2626;{% elif totals.due > 0 %}color:#15803d;{% else %}color:#6b7280;{% endif %}">
            {% if totals.due < 0 %}-₹ {{ totals.due|floatformat:0|cut:'-' }}{% elif totals.due > 0 %}₹ {{ totals.due|floatformat:0 }}{% else %}₹ 0{% endif %}
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% endblock %}
