{% extends "website/base.html" %}
{% block title %}Employee Full Salary Statement{% endblock %}
{% block content %}

<h2 style="margin-top:0;">Employee Full Salary Statement</h2>

<!-- Selection Panel -->
<div class="card" style="margin-bottom:14px;">
  <h3 class="form-section">Select Session & Employee</h3>
  
  <form method="get" style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap;">
    <div style="flex: 1; min-width: 250px;">
      <label style="font-weight: 700;">Session</label>
      <select name="session" style="height:40px; width:100%;">
        <option value="">-- Select Session --</option>
        {% for session in sessions %}
          <option value="{{ session.id }}" {% if session.id|stringformat:"s" == selected_session_id %}selected{% endif %}>
            {{ session.session }}
          </option>
        {% endfor %}
      </select>
    </div>
    
    <div style="flex: 1; min-width: 250px;">
      <label style="font-weight: 700;">Employee</label>
      <select name="employee" style="height:40px; width:100%;">
        <option value="">-- Select Employee --</option>
        {% for emp in employees_list %}
          <option value="{{ emp.id }}" {% if emp.id|stringformat:"s" == selected_employee_id %}selected{% endif %}>
            {{ emp.name }} ({{ emp.post }})
          </option>
        {% endfor %}
      </select>
    </div>
    
    <button type="submit" style="height:40px; padding: 0 20px;">Generate Statement</button>
  </form>
</div>

<!-- Statement Display -->
{% if selected_employee and selected_session %}
<div class="card" style="margin-bottom:14px;">
  <!-- Panel 1: Employee Info -->
  <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:20px; padding:15px; background:#fbfbfc; border:1px solid #e5e7eb; border-radius:8px; margin-bottom:20px;">
    <div>
      <label style="font-size:12px; color:#6b7280; font-weight:600;">Name</label>
      <div style="font-size:16px; font-weight:700;">{{ employee_info.name }}</div>
    </div>
    <div>
      <label style="font-size:12px; color:#6b7280; font-weight:600;">Post</label>
      <div style="font-size:16px; font-weight:700;">{{ employee_info.post }}</div>
    </div>
    <div>
      <label style="font-size:12px; color:#6b7280; font-weight:600;">Session</label>
      <div style="font-size:16px; font-weight:700;">{{ employee_info.session }}</div>
    </div>
    <div>
      <label style="font-size:12px; color:#6b7280; font-weight:600;">Status</label>
      <div style="font-size:16px; font-weight:700;">{{ employee_info.status }}</div>
    </div>
  </div>
  
  <!-- Panel 2: Monthly Salary Schedule -->
  <h3 class="form-section">Monthly Salary Schedule (Financial Year: April - March)</h3>
  <div style="overflow-x:auto; margin-bottom:30px;">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#f3f4f6; border-bottom:2px solid #d1d5db;">
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Year</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Month</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Payment Type</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Notes</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#dbeafe;">Amount</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#e0f2fe;">Paid Amount</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#fef3c7;">Net Due Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for month in monthly_salary_data %}
          <tr style="border-bottom:1px solid #e5e7eb;">
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ month.year }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ month.month }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ month.payment_type }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb; font-size:13px;">{{ month.notes }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dbeafe;">{{ month.salary_to_pay|floatformat:0 }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe;">
              {% if month.payment_type == 'Salary' %}
                {{ month.paid_amount|default_if_none:''|floatformat:0 }}
              {% endif %}
            </td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#fef3c7;">
              {% if month.payment_type == 'Salary' %}
                {{ month.net_due|default_if_none:''|floatformat:0 }}
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" style="padding:20px; text-align:center; color:#6b7280;">No salary data available</td>
          </tr>
        {% endfor %}
        {% if monthly_salary_data %}
        <tr style="background:#f3f4f6; border-top:2px solid #d1d5db; border-bottom:2px solid #d1d5db; font-weight:700;">
          <td colspan="4" style="padding:10px; border:1px solid #e5e7eb; text-align:right;">Total Salary to Pay</td>
           <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#dbeafe; font-weight:700;">{{ summary.total_salary|floatformat:0 }}</td>
           <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe; font-weight:700;">{{ summary.schedule_paid_total|floatformat:0 }}</td>
           <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#fef3c7; font-weight:700;">{{ summary.schedule_net_total|floatformat:0 }}</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  
  <!-- Panel 3: Payment Transactions -->
  <h3 class="form-section">Payment Transactions</h3>
  <div style="overflow-x:auto; margin-bottom:30px;">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#f3f4f6; border-bottom:2px solid #d1d5db;">
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Year</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Month</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Payment Date</th>
          <th style="padding:10px; text-align:left; border:1px solid #e5e7eb; font-weight:700;">Remarks</th>
          <th style="padding:10px; text-align:right; border:1px solid #e5e7eb; font-weight:700; background:#e0f2fe;">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for txn in payment_transactions %}
          <tr style="border-bottom:1px solid #e5e7eb;">
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ txn.year }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ txn.month }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ txn.date }}</td>
            <td style="padding:10px; border:1px solid #e5e7eb;">{{ txn.remarks }}</td>
            <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe;">{{ txn.amount|floatformat:0 }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5" style="padding:20px; text-align:center; color:#6b7280;">No payments recorded</td>
          </tr>
        {% endfor %}
        {% if payment_transactions %}
        <tr style="background:#f3f4f6; border-top:2px solid #d1d5db; border-bottom:2px solid #d1d5db; font-weight:700;">
          <td colspan="4" style="padding:10px; border:1px solid #e5e7eb; text-align:right;">Total Paid</td>
          <td style="padding:10px; text-align:right; border:1px solid #e5e7eb; background:#e0f2fe; font-weight:700;">{{ summary.total_paid|floatformat:0 }}</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  
  <!-- Summary Section -->
  <h3 class="form-section">Summary</h3>
  <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:15px;">
    <div style="padding:15px; background:#dbeafe; border:1px solid #bfdbfe; border-radius:8px;">
      <label style="font-size:12px; color:#0c4a6e; font-weight:600;">Total Salary Due</label>
      <div style="font-size:24px; font-weight:700; color:#0c4a6e; margin-top:5px;">{{ summary.total_salary|floatformat:0 }}</div>
      <div style="font-size:11px; color:#0c4a6e; margin-top:3px;">Old Dues: {{ summary.old_dues|floatformat:0 }} + Monthly: {{ summary.monthly_salary|floatformat:0 }} Ã— 12</div>
    </div>
    
    <div style="padding:15px; background:#e0f2fe; border:1px solid #bae6fd; border-radius:8px;">
      <label style="font-size:12px; color:#075985; font-weight:600;">Total Amount Paid</label>
      <div style="font-size:24px; font-weight:700; color:#075985; margin-top:5px;">{{ summary.total_paid|floatformat:0 }}</div>
    </div>
    
    <div style="padding:15px; border:1px solid #f0f0f0; border-radius:8px; {% if summary.total_due >= 0 %}background:#f0fdf4; border-color:#bbf7d0;{% else %}background:#fef2f2; border-color:#fecaca;{% endif %}">
      <label style="font-size:12px; font-weight:600; {% if summary.total_due >= 0 %}color:#15803d;{% else %}color:#dc2626;{% endif %}">Total Amount Due</label>
      <div style="font-size:24px; font-weight:700; {% if summary.total_due >= 0 %}color:#15803d;{% else %}color:#dc2626;{% endif %} margin-top:5px;">
        {% if summary.total_due >= 0 %}
          +{{ summary.total_due|floatformat:0 }}
        {% else %}
          {{ summary.total_due|floatformat:0 }}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
